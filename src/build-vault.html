<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Building Your Vault - Memoro Vault</title>
  <script src="libs/zip.min.js"></script>
  <script src="libs/argon2-browser.min.js"></script> <!-- Argon2 lib -->
  <script src="libs/secrets.min.js"></script>
  <script src="libs/jspdf.umd.min.js"></script>
  <script src="libs/qrcode.min.js"></script>
  <script type="module">
import init, { sha256_hash, derive_key, aes_gcm_encrypt, aes_gcm_decrypt } from './wasm/memoro_crypto.js';
window.initCryptoWasm = async () => {
  await init();
  window.sha256Hash = sha256_hash;
  window.deriveKeyRust = derive_key;
  window.aesEncryptRust = aes_gcm_encrypt;
  window.aesDecryptRust = aes_gcm_decrypt;
};
window.initCryptoWasm();
  </script>

<!-- Theme styles for Build Vault -->
<link id="theme-cypherpunk" rel="stylesheet" href="css/build-vault_cypherpunk.css">
<link id="theme-clean" rel="stylesheet" href="css/build-vault_clean.css" disabled>

</head>
<body>

<div id="vaultContainer">
  <canvas id="matrixCanvas"></canvas>

  <div id="mainContainer">
    <img id="memoroLogo" src="assets/memoro-logo-with-words.png" alt="Memoro Vault Logo" />

    <div id="progressBarWrapper">
      <div class="progress-label" id="progressLabel">Initializing vault builder...</div>
      <div class="progress-bar-container">
        <div class="progress-bar-fill" id="progressFill">
          <!-- 20 blocks (adjustable) -->
          <div class="progress-block"></div>
          <div class="progress-block"></div>
          <div class="progress-block"></div>
          <div class="progress-block"></div>
          <div class="progress-block"></div>
          <div class="progress-block"></div>
          <div class="progress-block"></div>
          <div class="progress-block"></div>
          <div class="progress-block"></div>
          <div class="progress-block"></div>
          <div class="progress-block"></div>
          <div class="progress-block"></div>
          <div class="progress-block"></div>
          <div class="progress-block"></div>
          <div class="progress-block"></div>
          <div class="progress-block"></div>
          <div class="progress-block"></div>
          <div class="progress-block"></div>
          <div class="progress-block"></div>
          <div class="progress-block"></div>
        </div>
      </div>
    </div>

    <div id="actionButtons">
      <button onclick="preserveAndGoBack()">Back to Answers</button>
      <button onclick="retryDownload()">Retry Download</button>
      <button onclick="window.location.href='dashboard.html'">Return to Dashboard</button>
    </div>
  </div>

  <div id="powPanel" class="pow-panel">
    <div class="pow-panel-wrapper">

      <!-- Final Instructions Modal -->
      <div id="postBuildModal" class="modal-overlay hidden">
        <div class="modal-box">
          <h2>Please Read Carefully</h2>
          <p>Your Memoro Vault has been successfully built and downloaded.</p>

          <p>To ensure it remains accessible for decades, it's critical to guard against <strong>bit rot</strong> — a slow form of data decay that can silently corrupt files over time.</p>

          <p>Even if someone remembers all your answers perfectly, a single missing byte can render your vault irretrievable. That's why secure, redundant storage is essential.</p>

          <h3>What to Do Next</h3>
          <ol>
            <li>Create a folder (e.g., <code>J's_Memoro_Vault</code>) on your computer.</li>
            <li>Place both of the following into that folder:
              <ul>
                <li>The downloaded vault ZIP file</li>
                <li>The Memoro Vault installer (e.g., <code>memoro-win.exe</code>, <code>.AppImage</code>, or <code>.dmg</code>)</li>
              </ul>
            </li>
            <li><strong>Duplicate that folder to multiple destinations:</strong>
              <ul>
                <li>1× <strong>M-DISC</strong> (for long-term archival)</li>
                <li>1× <strong>Cloud backup</strong> (e.g., Proton Drive or Google Drive)</li>
                <li>1× <strong>Offline USB/SSD</strong> (stored in a fireproof safe or Faraday bag)</li>
              </ul>
            </li>
            <li><strong>Create a paper backup (recommended):</strong>
              <ul>
                <li>Memoro Vault can generate a printable PDF of QR codes that reassemble your encrypted vault.</li>
                <li>Print these QR tiles on archival paper and store them in a secure location.</li>
                <li>This ensures recovery even if all digital copies are lost or corrupted.</li>
              </ul>
            </li>
            <li>Test access on another device while offline to verify integrity and function.</li>
            <li>Repeat this process whenever you update or rebuild your vault.</li>
          </ol>

          <h3>Why M-DISC?</h3>
          <p>M-DISCs use a permanent, stone-like recording layer, unlike dye-based DVDs or flash memory. They're immune to bit rot, magnetic damage, EMPs, and most environmental degradation.</p>
          <p>With proper storage, an M-DISC can last 100–1,000 years — making it ideal for preserving something irreplaceable.</p>

          <h3>Final Advice</h3>
          <ul>
            <li>Do <strong>not</strong> rely on a single copy.</li>
            <li>Do <strong>not</strong> trust cloud providers to exist forever.</li>
            <li>Do <strong>not</strong> assume your future self will remember every step.</li>
          </ul>

          <p>Redundancy is key to ensuring your vault remains accessible for generations to come.</p>

          <p>A copy of these instructions is also included inside your vault ZIP as
            <code>Vault_Builder_Instructions.txt</code>.
          </p>

          <div class="modal-actions">
            <button class="btn-primary" onclick="closePostBuildModal()">Got it</button>
          </div>
        </div>
      </div>

      <!-- Lite Picker Modal -->
      <div id="litePickerModal" class="modal-overlay hidden">
        <div class="modal-box wide">
          <div class="modal-header">
            <h2>Choose what to include in your Paper Backup (≤ 150 KB)</h2>
          </div>

          <div class="modal-body">
            <!-- Left column -->
            <div class="modal-left">
              <h3>Seeds & Final Message</h3>
              <div id="liteSeedsList" class="scroll-box"></div>

              <div class="checkbox-row">
                <label>
                  <input id="litePickFinalMsg" type="checkbox" />
                  <span>Include final message (as <code>final-message.txt</code>)</span>
                </label>
              </div>

              <h3>Uploads</h3>
              <div id="liteUploadsList" class="scroll-box"></div>
            </div>

            <!-- Right column -->
            <div class="modal-right">
              <h3>Summary</h3>
              <div class="summary-box">
                <div>Total selected (raw): <strong id="liteTotalBytes">0</strong> bytes</div>
                <div class="summary-note">Limit: 153,600 bytes (≈ 150 KB). Encryption adds overhead, but this raw cap keeps QR count reasonable.</div>
                <hr />
                <div id="litePickerError" class="error-msg"></div>
                <div class="button-row">
                  <button id="litePickerConfirm" class="btn-primary">Build Paper Backup</button>
                  <button id="litePickerCancel" class="btn-secondary">Cancel</button>
                </div>
              </div>
            </div>
          </div> <!-- /modal-body -->
        </div>   <!-- /modal-box -->
      </div>     <!-- /litePickerModal -->

    </div> <!-- /pow-panel-wrapper -->
  </div>   <!-- /powPanel -->
</div>     <!-- /vaultContainer -->
<script src="js/build-vault.js"></script>
</body> 
</html>